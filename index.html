<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forever ✱ Header</title>

    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="Forever ✱ Header – A halftone-style header design tool inspired by the Forever ✱ Notes project. Create custom wavy backgrounds with Font Awesome icons and export them as PNGs."
    />
    <meta
      name="keywords"
      content="Forever ✱ Header, Forever ✱ Notes, halftone, design tool, SVG, Font Awesome, GitHub Pages"
    />
    <meta name="author" content="Nathan Binding" />

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Forever ✱ Header – Halftone Header Design Tool" />
    <meta
      property="og:description"
      content="A customisable halftone header generator for notes, inspired by Forever Notes."
    />
    <meta property="og:image" content="https://nbinding.github.io/forever-header/screenshot.png" />
    <meta property="og:url" content="https://nbinding.github.io/forever-header/" />
    <meta name="twitter:card" content="summary_large_image" />

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Canvg Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvg@3.0.7/lib/umd.min.js"></script>

    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
      }

      .rounded-box {
        width: 800px;
        height: 200px;
        border-radius: 35px 35px 0 0;
        /* Top corners rounded, bottom corners sharp */
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #ccc;
        margin-bottom: 20px;
      }

      svg {
        width: 100%;
        height: 100%;
      }

      .btn-container {
        max-width: 800px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }

      .header {
        font-size: 2rem;
        font-weight: bold;
        margin-top: 20px;
        margin-bottom: 10px;
      }

      .footer {
        margin-top: 20px;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">Forever ✱ Header</div>

    <!-- GitHub Repo Link -->
    <div>
      <a href="https://github.com/nbinding/forever-header" target="_blank">
        <img
          src="https://img.shields.io/badge/GitHub-View%20on%20GitHub-black?style=for-the-badge&logo=github"
          alt="GitHub Repository"
        />
      </a>
    </div>

    <!-- SVG Container -->
    <div class="rounded-box">
      <svg id="halftone-svg" viewBox="0 0 800 200" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <style type="text/css">
            @font-face {
              font-family: 'FontAwesome';
              src: url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/webfonts/fa-solid-900.woff2')
                format('woff2');
            }
            text {
              font-family: 'FontAwesome';
            }
          </style>

          <!-- Dither Patterns -->
          <pattern id="halftone-black" width="8" height="8" patternUnits="userSpaceOnUse">
            <circle cx="4" cy="4" r="2" fill="#000" />
          </pattern>
          <pattern id="halftone-white" width="8" height="8" patternUnits="userSpaceOnUse">
            <circle cx="4" cy="4" r="2" fill="#fff" />
          </pattern>

          <!-- Clip Path Matching Rounded Corners -->
          <clipPath id="clip-rounded">
            <path d="M0,35 Q0,0 35,0 H765 Q800,0 800,35 L800,200 L0,200 Z" />
          </clipPath>

          <!-- Clip Path for Dithering Pattern (covers the bottom area) -->
          <clipPath id="clip-transparent">
            <!-- This path (set on element with id "halftone-path") defines the bottom area -->
            <path id="halftone-path" d="M0 100 Q200 50, 400 100 T800 100 L800 200 L0 200 Z" />
          </clipPath>
        </defs>

        <g clip-path="url(#clip-rounded)">
          <!-- Top Background (Off-white) following the chosen curve -->
          <!-- Compound path with fill-rule="evenodd" subtracts the inner (curve + bottom) portion -->
          <path id="top-bg" fill="#c0c0c0" fill-rule="evenodd" d="" shape-rendering="geometricPrecision" />

          <!-- Halftone Pattern (Bottom Area) -->
          <path
            id="dither-path"
            d="M0 100 Q200 50, 400 100 T800 100 L800 200 L0 200 Z"
            fill="url(#halftone-black)"
            clip-path="url(#clip-transparent)"
          />

          <!-- Font Awesome Icon -->
          <text
            id="fa-icon-overlay"
            x="100"
            y="50%"
            text-anchor="middle"
            font-family="FontAwesome"
            font-size="140"
            fill="url(#halftone-white)"
            dominant-baseline="middle"
          >
            &#xf005;
          </text>
        </g>
      </svg>
    </div>

    <!-- Controls -->
    <div class="btn-container">
      <!-- Dropdown for selecting shape type -->
      <select id="shape-selector" class="form-select w-auto">
        <option value="wavy">Wavy</option>
        <option value="mountain">Mountain Range</option>
        <option value="circles">Circles</option>
        <option value="sine">Sine Wave</option>
        <option value="scalloped">Scalloped</option>
      </select>
      <!-- Renamed button -->
      <button id="apply-shape" class="btn btn-dark">Apply/Randomise Shape</button>
      <button id="randomise-icon" class="btn btn-dark">Randomise Icon</button>
      <input
        id="icon-input"
        type="text"
        class="form-control w-auto d-inline"
        placeholder="Enter Font Awesome class (e.g., fa-solid fa-star)"
      />
      <button id="apply-icon" class="btn btn-dark">Apply Icon</button>
      <!-- New button to toggle display of the Font Awesome icon -->
      <button id="toggle-icon" class="btn btn-dark">Toggle Icon Display</button>
      <button id="toggle-dither" class="btn btn-dark">Toggle Dither Colour</button>
      <button id="download-image" class="btn btn-dark">Download as PNG</button>
    </div>

    <!-- Footer -->
    <div class="footer">
      Made with ❤️ by <a href="https://github.com/nbinding" target="_blank">nbinding</a>
    </div>

    <script>
      let ditherColour = "black";

      // --- Shape Generator Functions ---
      // All functions now end with " L800 200 L0 200 Z" for consistency.
      function generateWavyPath() {
        const randomY1 = Math.random() * 100 + 50;
        const randomY2 = Math.random() * 100 + 50;
        return `M0 100 Q200 ${randomY1}, 400 100 T800 ${randomY2} L800 200 L0 200 Z`;
      }

      function generateMountainRangePath() {
        let path = "M0 150";
        const segments = 8;
        const segmentWidth = 800 / segments;
        for (let i = 1; i <= segments; i++) {
          const x = i * segmentWidth;
          const y = i % 2 === 1 ? Math.random() * 40 + 50 : Math.random() * 20 + 130;
          path += ` L${x} ${y}`;
        }
        path += " L800 200 L0 200 Z";
        return path;
      }

      function generateCirclesPath() {
        let path = "M0 100";
        let x = 0;
        while (x < 800) {
          let segmentWidth = Math.random() * 80 + 40;
          if (x + segmentWidth > 800) {
            segmentWidth = 800 - x;
          }
          const radius = segmentWidth / 2;
          const sweepFlag = Math.random() > 0.5 ? 1 : 0;
          path += ` A${radius} ${radius} 0 0 ${sweepFlag} ${x + segmentWidth} 100`;
          x += segmentWidth;
        }
        path += " L800 200 L0 200 Z";
        return path;
      }

      function generateSinePath() {
        const amplitude = Math.random() * 30 + 20;
        const frequency = Math.random() * 2 + 1;
        const phase = Math.random() * Math.PI * 2;
        const steps = 40;
        let path = `M0 ${100 + amplitude * Math.sin(phase)}`;
        for (let i = 1; i <= steps; i++) {
          const x = (800 / steps) * i;
          const y = 100 + amplitude * Math.sin((2 * Math.PI * frequency * x) / 800 + phase);
          path += ` L${x} ${y}`;
        }
        path += " L800 200 L0 200 Z";
        return path;
      }

      function generateScallopedPath() {
        let path = "M0 100";
        let x = 0;
        let toggle = true;
        while (x < 800) {
          let segmentWidth = Math.random() * 50 + 50;
          if (x + segmentWidth > 800) {
            segmentWidth = 800 - x;
          }
          const radius = segmentWidth / 2;
          const sweepFlag = toggle ? 1 : 0;
          path += ` A${radius} ${radius} 0 0 ${sweepFlag} ${x + segmentWidth} 100`;
          x += segmentWidth;
          toggle = !toggle;
        }
        path += " L800 200 L0 200 Z";
        return path;
      }

      // --- Font Awesome Icon Update ---
      function updateIcon(unicode) {
        document.getElementById("fa-icon-overlay").innerHTML = unicode;
      }

      document.getElementById("apply-icon").addEventListener("click", () => {
        const inputValue = document.getElementById("icon-input").value.trim();
        const hiddenIcon = document.createElement("i");
        hiddenIcon.className = inputValue;
        document.body.appendChild(hiddenIcon);
        setTimeout(() => {
          const computedStyle = window.getComputedStyle(hiddenIcon, "::before");
          const unicode = computedStyle.content.replace(/['"]/g, "");
          if (unicode) {
            updateIcon(unicode);
          } else {
            alert("Invalid Font Awesome class. Try another.");
          }
          document.body.removeChild(hiddenIcon);
        }, 100);
      });

      document.getElementById("randomise-icon").addEventListener("click", () => {
        const sampleIcons = [
          "fa-solid fa-heart",
          "fa-solid fa-star",
          "fa-solid fa-rocket",
          "fa-solid fa-bell",
          "fa-solid fa-envelope",
          "fa-solid fa-camera",
          "fa-solid fa-car",
          "fa-solid fa-tree",
          "fa-solid fa-sun",
          "fa-solid fa-moon",
          "fa-solid fa-coffee",
          "fa-solid fa-thumbs-up",
          "fa-solid fa-check-circle"
        ];
        const randomIcon = sampleIcons[Math.floor(Math.random() * sampleIcons.length)];
        document.getElementById("icon-input").value = randomIcon;
        document.getElementById("apply-icon").click();
      });

      document.getElementById("toggle-dither").addEventListener("click", () => {
        const ditherPath = document.getElementById("dither-path");
        const overlayElement = document.getElementById("fa-icon-overlay");
        ditherColour = ditherColour === "black" ? "white" : "black";
        ditherPath.setAttribute("fill", `url(#halftone-${ditherColour})`);
        overlayElement.setAttribute("fill", `url(#halftone-${ditherColour === "black" ? "white" : "black"})`);
      });

      // --- Toggle Font Awesome Icon Display ---
      document.getElementById("toggle-icon").addEventListener("click", () => {
        const icon = document.getElementById("fa-icon-overlay");
        // Toggle using the SVG 'visibility' attribute
        if (icon.getAttribute("visibility") === "hidden") {
          icon.setAttribute("visibility", "visible");
        } else {
          icon.setAttribute("visibility", "hidden");
        }
      });

      // --- Update Shape and Compound Top Background ---
      function updateShape(newPath) {
        // Update bottom (dither) path
        document.getElementById("halftone-path").setAttribute("d", newPath);
        document.getElementById("dither-path").setAttribute("d", newPath);

        // Extract the curve part by removing the ending " L800 200 L0 200 Z"
        const curvePart = newPath.replace(/ L800 200 L0 200 Z$/, "");
        // Use a small epsilon offset to avoid a visible seam
        const epsilon = 0.1;
        const topBgPath = `M0,0 H800 V200 H0 Z ${curvePart} L800 ${200 - epsilon} L0 ${200 - epsilon} Z`;
        document.getElementById("top-bg").setAttribute("d", topBgPath);
      }

      document.getElementById("apply-shape").addEventListener("click", () => {
        const shapeType = document.getElementById("shape-selector").value;
        let newPath;
        switch (shapeType) {
          case "wavy":
            newPath = generateWavyPath();
            break;
          case "mountain":
            newPath = generateMountainRangePath();
            break;
          case "circles":
            newPath = generateCirclesPath();
            break;
          case "sine":
            newPath = generateSinePath();
            break;
          case "scalloped":
            newPath = generateScallopedPath();
            break;
          default:
            newPath = generateWavyPath();
        }
        updateShape(newPath);
      });

      // Set a default shape on page load
      document.addEventListener("DOMContentLoaded", () => {
        const defaultPath = generateWavyPath();
        updateShape(defaultPath);
      });

      document.getElementById("download-image").addEventListener("click", async () => {
        const svgElement = document.getElementById("halftone-svg");
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = 800;
        canvas.height = 200;
        const svgData = new XMLSerializer().serializeToString(svgElement);
        const canvgInstance = await canvg.Canvg.fromString(ctx, svgData);
        await canvgInstance.render();
        let iconClass = document.getElementById("icon-input").value.trim();
        let iconName = iconClass.split(" ").pop() || "default-icon";
        iconName = iconName.replace(/^fa-/, "").replace(/[^a-zA-Z0-9_-]/g, "");
        const filename = `forever-header-${iconName}.png`;
        const link = document.createElement("a");
        link.download = filename;
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    </script>
  </body>
</html>
