<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halftone Tool</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Forever Header – A halftone-style header design tool inspired by the Forever ✱ Notes project. Create custom wavy backgrounds with Font Awesome icons and export them as PNGs.">
    <meta name="keywords" content="Forever Header, Forever Notes, halftone, design tool, SVG, Font Awesome, GitHub Pages">
    <meta name="author" content="Nathan Binding">
    
    <!-- Open Graph Meta Tags (For Social Media Previews) -->
    <meta property="og:title" content="Forever ✱ Header – Halftone Header Design Tool">
    <meta property="og:description" content="A customisable halftone header generator for notes, inspired by Forever Notes.">
    <meta property="og:image" content="https://nbinding.github.io/forever-header/screenshot.png">
    <meta property="og:url" content="https://nbinding.github.io/forever-header/">
    <meta name="twitter:card" content="summary_large_image">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   
    <!-- Canvg Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvg@3.0.7/lib/umd.min.js"></script>

    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .rounded-box {
            width: 800px;
            height: 200px;
            border-radius: 35px 35px 0 0; /* Top corners rounded, bottom corners sharp */
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }
        svg {
            width: 100%;
            height: 100%;
        }
        .btn-container {
            max-width: 800px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
    </style>
</head>
<body>

    <div class="rounded-box">
        <svg id="halftone-svg" viewBox="0 0 800 200" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <style type="text/css">
                    @font-face {
                        font-family: 'FontAwesome';
                        src: url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/webfonts/fa-solid-900.woff2') format('woff2');
                    }
                    text {
                        font-family: 'FontAwesome';
                    }
                </style>

                <!-- Dither Patterns -->
                <pattern id="halftone-black" width="8" height="8" patternUnits="userSpaceOnUse">
                    <circle cx="4" cy="4" r="2" fill="#000" />
                </pattern>
                <pattern id="halftone-white" width="8" height="8" patternUnits="userSpaceOnUse">
                    <circle cx="4" cy="4" r="2" fill="#fff" />
                </pattern>

                <!-- Clip Path Matching Rounded Corners -->
                <clipPath id="clip-rounded">
                    <path d="
                        M 0,35 
                        Q 0,0 35,0 
                        H 765 
                        Q 800,0 800,35 
                        V 200 
                        H 0 
                        Z"/>
                </clipPath>
            </defs>

            <g clip-path="url(#clip-rounded)">
                <rect width="800" height="200" fill="#c0c0c0" />
                <path id="halftone-path" d="M0 100 Q 200 50, 400 100 T 800 100 V 200 H 0 Z" fill="url(#halftone-black)" />
                <text id="fa-icon-overlay" x="100" y="50%" text-anchor="middle" font-family="FontAwesome" font-size="140" fill="url(#halftone-white)" dominant-baseline="middle">
                    &#xf005; <!-- Default star icon -->
                </text>
            </g>
        </svg>
    </div>

    <div class="btn-container">
        <button id="randomize-shape" class="btn btn-dark">Randomize Shape</button>
        <button id="randomize-icon" class="btn btn-dark">Randomize Icon</button>
        <input id="icon-input" type="text" class="form-control w-auto d-inline" placeholder="Enter Font Awesome class (e.g., fa-solid fa-star)" />
        <button id="apply-icon" class="btn btn-dark">Apply Icon</button>
        <button id="toggle-dither" class="btn btn-dark">Toggle Dither Colour</button>
        <button id="download-image" class="btn btn-dark">Download as PNG</button>
    </div>

    <script>
        let ditherColour = "black";

        // Update the Font Awesome icon
        function updateIcon(unicode) {
            document.getElementById("fa-icon-overlay").innerHTML = unicode;
        }

        // Apply custom Font Awesome icon
        document.getElementById("apply-icon").addEventListener("click", () => {
            const inputValue = document.getElementById("icon-input").value.trim();
            const hiddenIcon = document.createElement("i");
            hiddenIcon.className = inputValue;
            document.body.appendChild(hiddenIcon);

            setTimeout(() => {
                const computedStyle = window.getComputedStyle(hiddenIcon, "::before");
                const unicode = computedStyle.content.replace(/['"]/g, "");
                if (unicode) {
                    updateIcon(unicode);
                } else {
                    alert("Invalid Font Awesome class. Try another.");
                }
                document.body.removeChild(hiddenIcon);
            }, 100);
        });

        // Toggle dither colour for background and icon
        document.getElementById("toggle-dither").addEventListener("click", () => {
            const halftonePath = document.getElementById("halftone-path");
            const overlayElement = document.getElementById("fa-icon-overlay");

            ditherColour = ditherColour === "black" ? "white" : "black";
            halftonePath.setAttribute("fill", `url(#halftone-${ditherColour})`);
            overlayElement.setAttribute("fill", `url(#halftone-${ditherColour === "black" ? "white" : "black"})`);
        });

        // Randomize SVG shape
        document.getElementById("randomize-shape").addEventListener("click", () => {
            const path = document.getElementById("halftone-path");
            const randomY1 = Math.random() * 100 + 50;
            const randomY2 = Math.random() * 100 + 50;
            path.setAttribute("d", `M0 100 Q 200 ${randomY1}, 400 100 T 800 ${randomY2} V 200 H 0 Z`);
        });

        // Download SVG as PNG
        document.getElementById("download-image").addEventListener("click", async () => {
            const svgElement = document.getElementById("halftone-svg");
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");

            canvas.width = 800;
            canvas.height = 200;

            const svgData = new XMLSerializer().serializeToString(svgElement);
            const canvgInstance = await canvg.Canvg.fromString(ctx, svgData);
            await canvgInstance.render();

            const link = document.createElement("a");
            link.download = "halftone-design.png";
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    </script>

</body>
</html>
